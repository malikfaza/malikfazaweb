<!DOCTYPE html>
<html lang="id" class="dark scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Malikfaza Studio - Premium Digital Solutions</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- AOS Animation CSS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <!-- Typography Plugin for Epic Descriptions -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

    <!-- SUPABASE JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        midnight: '#000e1e', 
                        cream: '#f8fafc',
                        accent: {
                            cyan: '#06b6d4',
                            red: '#ef4444',
                            orange: '#f97316',
                            yellow: '#eab308',
                            green: '#22c55e'
                        }
                    },
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        heading: ['"Outfit"', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-x': 'slideX 1.5s ease-in-out infinite',
                        'wiggle': 'wiggle 0.5s ease-in-out infinite',
                        'fade-in': 'fadeInUp 0.6s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        slideX: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '50%': { transform: 'translateX(5px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        },
                        fadeInUp: {
                            'from': { opacity: 0, transform: 'translateY(20px)' },
                            'to': { opacity: 1, transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
        }
        .light .glass {
            background: rgba(255, 255, 255, 0.9); 
            border: 1px solid rgba(255, 255, 255, 0.5); 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); 
            backdrop-filter: blur(8px);
            color: #0f172a;
        }
        
        .light nav.glass {
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .light .card-title { color: #0f172a; font-weight: 800; }
        .dark .card-title { color: #f1f5f9; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .drop-active { border-color: #06b6d4 !important; background-color: rgba(6, 182, 212, 0.1) !important; }
        .custom-checkbox:checked { background-color: #ef4444; border-color: #ef4444; }
        
        /* --- CARD NEON HOVER EFFECTS --- */
        .card-interactive {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            will-change: transform, box-shadow;
            transform-origin: center center;
        }

        .dark .card-interactive:hover {
            box-shadow: 0 10px 30px -10px rgba(6, 182, 212, 0.5), 0 0 20px rgba(6, 182, 212, 0.2), inset 0 0 0 1px rgba(6, 182, 212, 0.5);
            border-color: rgba(34, 211, 238, 0.8);
            transform: translateY(-5px) scale(1.03);
            z-index: 20;
        }

        .light .card-interactive:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #0ea5e9;
            transform: translateY(-5px) scale(1.03);
            z-index: 20;
        }
        
        .card-selected { 
            border: 2px solid #ef4444 !important; 
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
            transform: scale(0.96);
        }

        .animate-entry {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0; 
        }

        /* Sortable */
        .sortable-ghost { opacity: 0.5; background: rgba(34, 211, 238, 0.1); border: 2px dashed #06b6d4; }
        .sortable-drag { cursor: grabbing; transform: scale(1.05); }

        /* --- PROMO POPUP ANIMATIONS --- */
        #promoContainer { transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .promo-mode-big { position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); padding: 1rem; opacity: 1; pointer-events: auto; }
        .promo-mode-big .promo-card { width: 100%; max-width: 400px; transform: scale(1) translateY(0); opacity: 1; border-radius: 24px; }
        .promo-mode-mini { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 90; width: auto; min-width: 320px; max-width: 90%; pointer-events: none; }
        .promo-mode-mini .promo-card { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.15); padding: 8px 16px; border-radius: 9999px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4); pointer-events: auto; transform: scale(1) translateY(0); }
        .light .promo-mode-mini .promo-card { background: rgba(255, 255, 255, 0.95); border: 1px solid #cbd5e1; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        .promo-hidden { opacity: 0; pointer-events: none; }
        .promo-mode-big.promo-hidden .promo-card { transform: scale(0.9) translateY(20px); }
        .promo-mode-mini.promo-hidden { transform: translateX(-50%) translateY(100px); }
        .promo-mode-mini .big-only { display: none; }
        .promo-mode-big .mini-only { display: none; }

        .grid-mobile-80 { grid-template-columns: repeat(auto-fill, 80%); grid-auto-columns: 80%; }
        
        .collapsible-content { transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out; max-height: 0; opacity: 0; overflow: hidden; }
        .collapsible-content.open { max-height: 500px; opacity: 1; }

        /* INFINITE MARQUEE ANIMATION */
        .marquee-wrapper {
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }
        .marquee-content {
            display: flex;
            gap: 1.5rem;
            width: max-content;
            animation: marquee 50s linear infinite;
        }
        .marquee-content:hover {
            animation-play-state: paused;
        }
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* Custom Styles for Epic Description */
        .epic-desc ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .epic-desc li { margin-bottom: 0.5rem; }
        .epic-desc strong { color: #22d3ee; }
        .light .epic-desc strong { color: #0284c7; }
        .epic-desc h1, .epic-desc h2, .epic-desc h3 { font-family: 'Outfit', sans-serif; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.5rem; }

        /* Purchase Notification Style */
        #purchaseToast {
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
    </style>
</head>
<body class="bg-cream text-slate-900 dark:bg-midnight dark:text-slate-200 transition-colors duration-500 font-sans selection:bg-accent-cyan selection:text-white overflow-x-hidden antialiased">

    <audio id="bgMusic" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112191.mp3" type="audio/mpeg">
    </audio>

    <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
        <div class="absolute top-0 left-1/4 w-64 h-64 md:w-96 md:h-96 bg-accent-cyan/20 rounded-full mix-blend-multiply filter blur-[100px] opacity-40 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-64 h-64 md:w-96 md:h-96 bg-accent-orange/20 rounded-full mix-blend-multiply filter blur-[100px] opacity-40 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-64 h-64 md:w-96 md:h-96 bg-accent-green/20 rounded-full mix-blend-multiply filter blur-[100px] opacity-40 animate-blob animation-delay-4000"></div>
    </div>

    <!-- Navigation -->
    <nav class="fixed w-full z-50 glass shadow-sm transition-all duration-300" id="navbar">
        <div class="container mx-auto px-6 py-3 md:py-4 flex justify-between items-center">
            <a href="#" class="text-xl md:text-2xl font-heading font-bold tracking-tight group dark:text-white text-slate-900 flex items-center gap-1">
                Malikfaza<span class="text-accent-cyan animate-pulse">.</span>Studio
            </a>
            
            <div class="hidden md:flex items-center gap-8 font-medium dark:text-gray-300 text-slate-600 text-sm">
                <a href="#home" class="hover:text-accent-cyan transition-colors relative group" data-i18n="nav_home">Home<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-accent-cyan transition-all group-hover:w-full"></span></a>
                <a href="#products" class="hover:text-accent-cyan transition-colors relative group" data-i18n="nav_products">Products<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-accent-cyan transition-all group-hover:w-full"></span></a>
                <a href="#services" class="hover:text-accent-cyan transition-colors relative group" data-i18n="nav_services">Services<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-accent-cyan transition-all group-hover:w-full"></span></a>
                <a href="#contact" class="hover:text-accent-cyan transition-colors relative group" data-i18n="nav_contact">Contact<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-accent-cyan transition-all group-hover:w-full"></span></a>
            </div>

            <div class="flex items-center gap-2 md:gap-3">
                <button onclick="toggleMusic()" class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors text-accent-red border border-transparent group">
                    <i id="musicIcon" class="ri-music-2-line group-hover:animate-wiggle"></i>
                </button>
                <button id="langToggle" class="p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors font-bold text-[10px] border border-current w-9 h-9 flex items-center justify-center">ID</button>
                <button id="themeToggle" class="p-1.5 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors text-accent-yellow w-9 h-9 flex items-center justify-center">
                    <i class="ri-sun-line text-lg dark:hidden"></i>
                    <i class="ri-moon-line text-lg hidden dark:block"></i>
                </button>
                <button class="md:hidden text-2xl dark:text-white text-slate-900 ml-1" onclick="document.getElementById('mobileMenu').classList.toggle('hidden')">
                    <i class="ri-menu-4-line"></i>
                </button>
            </div>
        </div>
        
        <div id="mobileMenu" class="hidden md:hidden glass border-t border-gray-200 dark:border-gray-800 p-4 absolute w-full top-[60px] left-0 z-40 shadow-xl backdrop-blur-xl">
            <div class="flex flex-col gap-4 font-medium dark:text-gray-200 text-slate-700 text-sm">
                <a href="#home" class="block hover:text-accent-cyan hover:pl-2 transition-all" data-i18n="nav_home">Home</a>
                <a href="#products" class="block hover:text-accent-cyan hover:pl-2 transition-all" data-i18n="nav_products">Products</a>
                <a href="#services" class="block hover:text-accent-cyan hover:pl-2 transition-all" data-i18n="nav_services">Services</a>
                <a href="#contact" class="block hover:text-accent-cyan hover:pl-2 transition-all" data-i18n="nav_contact">Contact</a>
                <button id="adminBtnMobile" class="text-left text-accent-red mt-2 font-bold uppercase tracking-wider text-xs border-t border-dashed border-gray-500/30 pt-4">Admin Login</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header id="home" class="min-h-screen flex items-center pt-24 pb-12 relative">
        <div class="container mx-auto px-6 grid md:grid-cols-2 gap-8 md:gap-16 items-center">
            <div class="order-2 md:order-1 text-center md:text-left" data-aos="fade-right">
                <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full border border-accent-cyan/30 bg-accent-cyan/5 text-accent-cyan text-[10px] md:text-xs font-bold uppercase tracking-wider mb-6 hover:bg-accent-cyan/10 transition-colors">
                    <span class="w-2 h-2 rounded-full bg-accent-cyan animate-pulse"></span>
                    Premium Digital Solutions
                </div>
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-heading font-extrabold mb-6 leading-tight dark:text-white text-slate-900">
                    <span data-i18n="hero_title_1">Upgrade Your</span> <br>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-accent-cyan via-accent-green to-accent-yellow animate-pulse-slow" data-i18n="hero_highlight">Digital Life</span>
                </h1>
                <p class="text-sm md:text-lg text-gray-600 dark:text-gray-400 mb-8 max-w-lg mx-auto md:mx-0 leading-relaxed" data-i18n="hero_desc">
                    Pusat tools premium, jasa kreatif, dan aset digital berkualitas tinggi. Tingkatkan produktivitas Anda sekarang.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                    <a href="#products" onclick="window.startMusic()" class="px-8 py-3.5 bg-accent-cyan text-white rounded-xl font-bold hover:bg-cyan-500 transition-all shadow-lg shadow-cyan-500/30 flex items-center justify-center gap-2 text-sm hover:-translate-y-1">
                        <i class="ri-shopping-bag-3-line text-lg"></i> <span data-i18n="cta_shop">Lihat Katalog</span>
                    </a>
                    <a href="https://chat.whatsapp.com/CauOC4ITK0eII8meEr6dSH" target="_blank" class="px-8 py-3.5 bg-green-600/10 border border-green-500/50 text-green-600 dark:text-green-400 rounded-xl font-bold hover:bg-green-600 hover:text-white hover:border-green-600 transition-all flex items-center justify-center gap-2 text-sm hover:-translate-y-1 group">
                        <i class="ri-whatsapp-line text-lg group-hover:rotate-12 transition-transform"></i> Join Komunitas AI
                    </a>
                </div>
                <p class="mt-4 text-[10px] text-gray-400">
                    *Dapatkan voucher spesial khusus anggota grup!
                </p>
                <p class="mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2 justify-center md:justify-start">
                    <i class="ri-gift-line text-accent-cyan animate-bounce"></i>
                    Mau produk gratis? <a href="https://lynk.id/malikfaza" target="_blank" class="text-accent-cyan hover:underline font-bold">Ambil di sini</a>
                </p>
            </div>
            <div class="order-1 md:order-2 relative px-4 md:px-0" data-aos="fade-left">
                <div class="relative z-10 animate-float group perspective">
                    <div class="absolute -inset-1 bg-gradient-to-r from-accent-cyan to-accent-purple rounded-2xl blur opacity-30 group-hover:opacity-60 transition duration-1000 group-hover:duration-200"></div>
                    <img src="https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=1000&auto=format&fit=crop" alt="Digital Creative" class="relative rounded-2xl shadow-2xl border border-white/10 w-full h-64 md:h-[500px] object-cover transform transition-transform duration-500 group-hover:scale-[1.02]">
                    <div class="absolute -bottom-6 -left-6 bg-white dark:bg-slate-800 p-4 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 animate-float" style="animation-delay: 1s;">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-500"><i class="ri-secure-payment-line"></i></div>
                            <div>
                                <p class="text-xs text-gray-500">Secure</p>
                                <p class="text-sm font-bold dark:text-white">Transaction</p>
                            </div>
                        </div>
                    </div>
                     <div class="absolute -top-6 -right-6 bg-white dark:bg-slate-800 p-4 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 animate-delay-2s">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-500"><i class="ri-star-smile-fill"></i></div>
                            <div>
                                <p class="text-xs text-gray-500">Rating</p>
                                <p class="text-sm font-bold dark:text-white">5.0 / 5.0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Control Panel -->
    <div id="adminPanel" class="hidden container mx-auto px-6 mb-8 transition-all duration-300">
        <div class="p-5 rounded-2xl border border-accent-red bg-red-50 dark:bg-red-900/10 shadow-lg flex flex-col md:flex-row justify-between items-center gap-4 animate-fade-in relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-accent-red"></div>
            <div>
                <h2 class="text-base font-bold text-accent-red flex items-center gap-2">
                    <i class="ri-admin-fill text-xl"></i> ADMIN DASHBOARD
                </h2>
                <div class="text-[11px] text-gray-600 dark:text-gray-400 mt-1 flex items-center gap-2">
                    System Status: <span id="dbStatus" class="font-bold text-gray-500 flex items-center gap-1"><i class="ri-cloud-line"></i> Connecting...</span>
                </div>
            </div>
            <div class="flex flex-wrap gap-2 w-full md:w-auto justify-center md:justify-end">
                <button id="btnAdd" onclick="window.openAddModal()" class="px-4 py-2 bg-green-600 text-white text-xs font-bold rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 shadow-lg hover:-translate-y-0.5 transform">
                    <i class="ri-add-circle-line text-base"></i> Tambah Produk
                </button>
                <button id="btnDelete" onclick="window.deleteSelected()" class="px-4 py-2 bg-red-600 text-white text-xs font-bold rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center gap-2 shadow-lg hover:-translate-y-0.5 transform">
                    <i class="ri-delete-bin-line text-base"></i> Hapus Terpilih
                </button>
                <button id="btnReset" onclick="window.uploadDefaultData()" class="px-4 py-2 bg-blue-600 text-white text-xs font-bold rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 shadow-lg hover:-translate-y-0.5 transform">
                    <i class="ri-refresh-line text-base"></i> Reset Data
                </button>
                <button onclick="window.openPromoSettings()" class="px-4 py-2 bg-yellow-600 text-white text-xs font-bold rounded-lg hover:bg-yellow-700 transition-colors flex items-center justify-center gap-2 shadow-lg hover:-translate-y-0.5 transform">
                    <i class="ri-coupon-3-line text-base"></i> Set Promo
                </button>
                
                <!-- NEW: Import & Export Group -->
                <div class="flex gap-2">
                    <!-- Import Button & Hidden Input -->
                    <input type="file" id="importFileInput" class="hidden" accept=".json" onchange="window.importData(this)">
                    <button onclick="document.getElementById('importFileInput').click()" class="px-4 py-2 bg-purple-600 text-white text-xs font-bold rounded-lg hover:bg-purple-700 transition-colors flex items-center justify-center gap-2 shadow-lg hover:-translate-y-0.5 transform">
                        <i class="ri-upload-cloud-2-line text-base"></i> Import JSON
                    </button>
                    
                    <button onclick="window.exportData()" class="px-4 py-2 bg-indigo-600 text-white text-xs font-bold rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2 shadow-lg hover:-translate-y-0.5 transform">
                        <i class="ri-download-cloud-2-line text-base"></i> Export
                    </button>
                </div>

                <button onclick="window.logoutAdmin()" class="px-4 py-2 bg-slate-700 text-white text-xs font-bold rounded-lg hover:bg-slate-800 transition-colors flex items-center justify-center gap-2 shadow-lg hover:-translate-y-0.5 transform">
                    <i class="ri-logout-box-r-line text-base"></i> Logout
                </button>
            </div>
        </div>
    </div>

    <!-- Products Section -->
    <section id="products" class="py-12 md:py-24 relative overflow-hidden">
        <div class="container mx-auto px-6">
            <div class="text-center mb-10 md:mb-16" data-aos="fade-up">
                <h2 class="text-3xl md:text-5xl font-heading font-bold mb-3 dark:text-white text-slate-900"><span class="text-accent-cyan">Digital</span> <span data-i18n="section_products_title">Catalog</span></h2>
                <div class="w-20 h-1.5 bg-gradient-to-r from-accent-cyan to-accent-green mx-auto rounded-full mb-4"></div>
                <p class="text-sm text-gray-500 dark:text-gray-400 max-w-xl mx-auto" data-i18n="section_products_subtitle">Koleksi tools premium pilihan untuk kebutuhan digital Anda.</p>
            </div>

            <!-- SEARCH BAR -->
            <div class="max-w-xl mx-auto mb-10 relative px-2" data-aos="fade-up" data-aos-delay="100">
                <input type="text" id="searchInput" placeholder="Cari aplikasi, tools, atau jasa..." class="w-full pl-14 pr-6 py-4 rounded-full bg-white dark:bg-white/5 border border-gray-200 dark:border-white/10 focus:border-accent-cyan focus:ring-2 focus:ring-accent-cyan/20 focus:outline-none dark:text-white shadow-lg text-sm transition-all backdrop-blur-sm relative z-0" oninput="window.handleSearch(this.value)">
                <div class="absolute inset-y-0 left-6 flex items-center pointer-events-none z-10">
                    <i class="ri-search-line text-gray-400 text-xl"></i>
                </div>
                <div class="absolute inset-y-0 right-4 flex items-center z-10">
                    <span class="text-[10px] bg-gray-100 dark:bg-white/10 px-2 py-1 rounded text-gray-500 border border-gray-200 dark:border-white/10">CTRL+K</span>
                </div>
            </div>

            <div class="flex overflow-x-auto gap-3 md:gap-4 mb-10 pb-4 md:pb-0 justify-start md:justify-center no-scrollbar px-2 snap-x" id="categoryFilters">
                <!-- JS Generated -->
            </div>
            
            <!-- PRODUCT GRID / CAROUSEL -->
            <div class="relative group min-h-[400px]">
                <div id="productContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8 pb-10">
                    <!-- JS Generated -->
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-16 md:py-24 bg-gray-50 dark:bg-black/20 border-y border-gray-200 dark:border-white/5">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-end mb-12 text-center md:text-left" data-aos="fade-up">
                <div class="w-full md:w-auto">
                    <h2 class="text-3xl md:text-4xl font-heading font-bold mb-3 dark:text-white text-slate-900">Creative <span class="text-accent-yellow" data-i18n="section_services_title">Services</span></h2>
                    <p class="text-gray-500 text-sm" data-i18n="section_services_subtitle">Solusi kreatif profesional untuk bisnis Anda.</p>
                </div>
                <a href="https://wa.me/6285161141114?text=Halo%20Malikfaza,%20saya%20ingin%20konsultasi%20gratis." target="_blank" class="text-accent-yellow font-bold hover:text-white hover:bg-accent-yellow px-4 py-2 rounded-lg transition-all mt-4 md:mt-0 flex items-center justify-center gap-2 w-full md:w-auto text-sm border border-accent-yellow">
                    Konsultasi Gratis <i class="ri-whatsapp-line"></i>
                </a>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-8" id="serviceContainer">
                <!-- JS Generated -->
            </div>
        </div>
    </section>

    <!-- Testimonials Section (INFINITE LOOP) -->
    <section id="testimonials" class="py-24 relative overflow-hidden bg-white/50 dark:bg-black/20">
        <!-- Background Elements -->
        <div class="absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden">
            <div class="absolute top-1/4 -right-20 w-72 h-72 bg-accent-cyan/5 rounded-full blur-3xl"></div>
            <div class="absolute bottom-1/4 -left-20 w-72 h-72 bg-accent-yellow/5 rounded-full blur-3xl"></div>
        </div>

        <div class="container mx-auto px-6 relative z-10 mb-12">
            <div class="text-center" data-aos="fade-up">
                <h2 class="text-3xl md:text-5xl font-heading font-bold mb-4 dark:text-white text-slate-900">
                    Trusted by <span class="text-transparent bg-clip-text bg-gradient-to-r from-accent-cyan to-blue-500">Community</span>
                </h2>
                <div class="w-16 h-1 bg-accent-cyan mx-auto rounded-full"></div>
                <p class="mt-4 text-gray-500 dark:text-gray-400 max-w-xl mx-auto text-sm">
                    Pengalaman nyata dari mereka yang sudah merasakan manfaat produk digital kami.
                </p>
            </div>
        </div>

        <!-- Marquee Container -->
        <div class="marquee-wrapper w-full overflow-hidden">
            <div class="marquee-content" id="testimonialContainer">
                <!-- JS Generated (Original + Duplicate for Loop) -->
            </div>
        </div>
    </section>

    <!-- Contact Form Section (REALLY SIMPLE & CENTERED) -->
    <section id="contact" class="py-20 relative overflow-hidden">
        <div class="container mx-auto px-6 relative z-10">
            <div class="glass p-8 rounded-3xl border border-gray-200 dark:border-white/10 bg-white/50 dark:bg-white/5 shadow-2xl max-w-2xl mx-auto text-center" data-aos="fade-up">
                
                <div class="mb-8">
                    <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-accent-cyan/10 text-accent-cyan text-xs font-bold uppercase tracking-wider mb-4 border border-accent-cyan/20">
                        <span class="w-2 h-2 rounded-full bg-accent-cyan animate-pulse"></span>
                        Let's Connect
                    </div>
                    <h2 class="text-2xl md:text-4xl font-heading font-bold mb-3 dark:text-white text-slate-900 leading-tight">
                        <span data-i18n="contact_title">Punya Ide Project?</span> <br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-accent-cyan to-accent-green" data-i18n="contact_subtitle">Mari Wujudkan.</span>
                    </h2>
                    <p class="text-gray-500 dark:text-gray-400 text-sm leading-relaxed max-w-md mx-auto" data-i18n="contact_desc">
                        Klik tombol di bawah untuk mengirim pesan cepat langsung ke WhatsApp Admin.
                    </p>
                </div>

                <!-- Toggle Button (Centered) -->
                <button id="toggleFormBtn" onclick="toggleContactForm()" class="w-full max-w-xs mx-auto py-3 bg-white dark:bg-white/10 border border-gray-200 dark:border-white/10 rounded-xl font-bold shadow-sm hover:shadow-md transition-all flex items-center justify-center gap-2 group mb-2">
                    <i class="ri-mail-add-line text-lg text-accent-cyan"></i>
                    <span class="dark:text-white text-slate-700 text-sm" data-i18n="toggle_form_open">Buka Formulir Pesan</span>
                    <i id="toggleIcon" class="ri-arrow-down-s-line transition-transform"></i>
                </button>

                <!-- Collapsible Form Container (Centered & Compact) -->
                <div id="formWrapper" class="collapsible-content max-w-xs mx-auto">
                    <div class="pt-4">
                        <form onsubmit="window.sendToWhatsapp(event)" class="space-y-4 bg-white dark:bg-black/40 p-5 rounded-2xl border border-gray-200 dark:border-white/10 shadow-lg text-left">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1 uppercase tracking-wide" data-i18n="form_name">Nama</label>
                                <input type="text" id="contactName" required class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition-all dark:text-white text-sm" placeholder="Nama Anda">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1 uppercase tracking-wide" data-i18n="form_message">Pesan</label>
                                <textarea id="contactMessage" rows="3" required class="w-full px-4 py-2.5 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition-all dark:text-white text-sm resize-none" placeholder="Tulis pesan singkat..."></textarea>
                            </div>
                            <button type="submit" class="w-full py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl font-bold transition-all shadow-lg hover:shadow-green-500/30 transform hover:-translate-y-1 flex items-center justify-center gap-2 group text-sm">
                                <span data-i18n="form_btn">Kirim via WhatsApp</span>
                                <i class="ri-whatsapp-fill text-lg group-hover:rotate-12 transition-transform"></i>
                            </button>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white dark:bg-black/40 pt-16 pb-8 border-t border-gray-200 dark:border-white/5 relative overflow-hidden">
        <!-- Footer bg decoration -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-1 bg-gradient-to-r from-transparent via-accent-cyan to-transparent opacity-50"></div>
        
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-4 gap-12 mb-12">
                <div class="md:col-span-2">
                    <h3 class="text-2xl font-heading font-bold mb-4 dark:text-white text-slate-900 flex items-center gap-2">
                        Malikfaza.Studio <span class="text-accent-cyan text-4xl leading-none">.</span>
                    </h3>
                    <p class="text-gray-500 dark:text-gray-400 mb-6 max-w-sm text-sm leading-relaxed">
                        Partner digital terpercaya di Majalengka, Jawa Barat. Kami menyediakan solusi digital lengkap mulai dari tools produktivitas hingga jasa kreatif.
                    </p>
                    <div class="flex gap-3">
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-white/5 border border-gray-200 dark:border-white/10 flex items-center justify-center text-slate-600 dark:text-white hover:bg-accent-cyan hover:border-accent-cyan hover:text-white transition-all transform hover:scale-110"><i class="ri-instagram-line"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-white/5 border border-gray-200 dark:border-white/10 flex items-center justify-center text-slate-600 dark:text-white hover:bg-accent-red hover:border-accent-red hover:text-white transition-all transform hover:scale-110"><i class="ri-youtube-fill"></i></a>
                        <a href="https://lynk.id/malikfaza" target="_blank" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-white/5 border border-gray-200 dark:border-white/10 flex items-center justify-center text-slate-600 dark:text-white hover:bg-accent-green hover:border-accent-green hover:text-white transition-all transform hover:scale-110"><i class="ri-shopping-bag-3-fill"></i></a>
                    </div>
                </div>
                <div>
                    <h4 class="font-bold text-base mb-6 dark:text-white text-slate-900 relative inline-block">Contact <span class="absolute -bottom-2 left-0 w-1/2 h-0.5 bg-accent-cyan"></span></h4>
                    <ul class="space-y-4 text-gray-500 dark:text-gray-400 text-sm">
                        <li class="flex items-center gap-3 group"><div class="w-8 h-8 rounded bg-green-500/10 flex items-center justify-center text-green-500 group-hover:bg-green-500 group-hover:text-white transition-colors"><i class="ri-whatsapp-line"></i></div><a href="https://wa.me/6285161141114?text=Halo" class="hover:text-accent-cyan transition-colors">+62 851-6114-1114</a></li>
                        <li class="flex items-center gap-3 group"><div class="w-8 h-8 rounded bg-red-500/10 flex items-center justify-center text-accent-red group-hover:bg-accent-red group-hover:text-white transition-colors"><i class="ri-mail-line"></i></div><a href="mailto:abdul.m4lik1999@gmail.com" class="hover:text-accent-cyan transition-colors break-all">abdul.m4lik1999@gmail.com</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-base mb-6 dark:text-white text-slate-900 relative inline-block">Quick Links <span class="absolute -bottom-2 left-0 w-1/2 h-0.5 bg-accent-cyan"></span></h4>
                    <ul class="space-y-3 text-gray-500 dark:text-gray-400 text-sm">
                        <li><a href="#home" class="hover:text-accent-cyan hover:pl-2 transition-all block">Home</a></li>
                        <li><a href="#products" class="hover:text-accent-cyan hover:pl-2 transition-all block">Catalog</a></li>
                        <li><button id="adminLoginFooter" class="uppercase tracking-widest hover:text-accent-cyan mt-4 opacity-50 hover:opacity-100 font-bold text-[10px] border-b border-dashed border-gray-500">Admin Access</button></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-200 dark:border-white/10 pt-8 text-center text-gray-500 dark:text-gray-600 text-xs flex flex-col md:flex-row justify-between items-center gap-2">
                <p>&copy; 2024 Malikfaza Studio. All rights reserved.</p>
                <p>Designed with <i class="ri-heart-fill text-red-500 animate-pulse"></i> by Malikfaza</p>
            </div>
        </div>
    </footer>

    <!-- PROMO POPUP (Smooth Transition Container) -->
    <div id="promoContainer" class="promo-hidden fixed z-[100] transition-all duration-700 ease-out">
        <div id="promoCard" class="glass promo-card relative overflow-hidden">
            <!-- Glass Shine Effect -->
            <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-tr from-white/10 to-transparent pointer-events-none"></div>

            <!-- BIG MODE CONTENT -->
            <div class="big-only w-full relative">
                <!-- Minimize Button (Moved to Top Right - Replaces Close Button) -->
                <button onclick="window.minimizePromo()" class="absolute top-3 right-3 text-gray-400 hover:text-white transition-colors bg-black/20 rounded-full w-8 h-8 flex items-center justify-center z-10 hover:bg-black/30" title="Minimize">
                    <i class="ri-arrow-down-s-line text-xl"></i>
                </button>

                <!-- Close Button REMOVED as per request -->

                <div class="flex flex-col items-center text-center p-6">
                    <div class="bg-gradient-to-br from-accent-yellow to-orange-500 p-4 rounded-full text-white mb-4 animate-bounce shadow-lg shadow-orange-500/30 ring-4 ring-orange-500/20">
                        <i class="ri-gift-2-fill text-4xl"></i>
                    </div>
                    <h3 id="promoTitleDisplay" class="text-2xl font-bold text-slate-800 dark:text-white mb-1">Diskon Spesial!</h3>
                    <p id="promoDateText" class="text-accent-cyan text-xs font-bold uppercase tracking-widest mb-2 bg-accent-cyan/10 px-3 py-1 rounded-full">Promo Hari Ini</p>
                    <p id="promoDescDisplay" class="text-gray-600 dark:text-gray-300 text-sm mb-6 px-4">Gunakan kode voucher di bawah ini untuk mendapatkan potongan harga.</p>
                    
                    <div class="group relative w-full mb-6 max-w-xs mx-auto">
                        <div class="absolute -inset-0.5 bg-gradient-to-r from-accent-cyan to-accent-green rounded-lg blur opacity-30 group-hover:opacity-75 transition duration-200"></div>
                        <div class="relative flex items-center gap-3 bg-white dark:bg-black/60 px-4 py-3 rounded-lg border border-white/10 w-full justify-between cursor-pointer active:scale-95 transition-transform" onclick="window.copyToClipboard(null)">
                            <span id="promoCodeDisplay" class="font-mono font-bold text-accent-yellow text-2xl tracking-widest">FAZA20</span>
                            <div class="flex items-center gap-1 text-xs text-gray-400 font-bold">
                                <span>SALIN</span>
                                <i class="ri-file-copy-line text-lg"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-2 text-red-500 text-xs font-bold bg-red-50 dark:bg-red-900/20 px-4 py-2 rounded-full border border-red-200 dark:border-red-500/20 shadow-inner">
                        <i class="ri-timer-flash-line animate-pulse text-lg"></i> Berakhir dalam: <span class="promoTimer font-mono ml-1 text-base">--:--:--</span>
                    </div>
                </div>
            </div>

            <!-- MINI MODE CONTENT -->
            <div class="mini-only w-full flex items-center justify-between gap-3 px-1">
                <div class="flex items-center gap-3 flex-1 cursor-pointer" onclick="window.maximizePromo()">
                    <div class="w-9 h-9 rounded-full bg-gradient-to-br from-accent-yellow to-orange-500 text-white flex items-center justify-center font-bold text-sm shadow-lg shadow-orange-500/30 animate-pulse">
                        %
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] font-bold text-slate-800 dark:text-white leading-tight">Voucher Tersedia</span>
                        <span class="text-[9px] font-mono text-red-500 dark:text-accent-yellow promoTimer">--:--:--</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="window.maximizePromo()" class="text-[10px] bg-black dark:bg-white text-white dark:text-black px-3 py-1.5 rounded-full font-bold hover:scale-105 transition-transform shadow-lg">Lihat</button>
                    <!-- Close Button REMOVED -->
                </div>
            </div>
        </div>
    </div>

    <!-- Live Purchase Notification -->
    <div id="purchaseToast" class="fixed bottom-6 left-6 z-[150] translate-y-[200%] opacity-0 pointer-events-none">
        <div class="glass p-3 pr-5 rounded-2xl border border-white/20 bg-slate-900/80 backdrop-blur-lg flex items-center gap-3 shadow-xl max-w-xs">
            <div class="relative">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-accent-cyan to-blue-600 flex items-center justify-center text-white font-bold text-sm shadow-md border border-white/20" id="purchaseAvatar">
                    <!-- Initials -->
                </div>
                <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-slate-900 flex items-center justify-center">
                    <i class="ri-check-line text-[10px] text-white"></i>
                </div>
            </div>
            <div>
                <p class="text-xs text-white leading-tight">
                    <span class="font-bold text-accent-cyan" id="purchaseName">Nama</span> baru saja membeli
                </p>
                <p class="text-[10px] text-gray-300 font-medium mt-0.5" id="purchaseProduct">Nama Produk</p>
                <p class="text-[9px] text-gray-400 mt-0.5 flex items-center gap-1">
                    <i class="ri-time-line"></i> <span id="purchaseTime">Baru saja</span>
                </p>
            </div>
            <button onclick="hidePurchaseNotification()" class="absolute top-1 right-1 text-gray-500 hover:text-white p-1">
                <i class="ri-close-line text-xs"></i>
            </button>
        </div>
    </div>

    <!-- Promo Settings Modal -->
    <div id="promoSettingsModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/90 backdrop-blur-sm p-4 animate-entry">
        <div class="glass dark:bg-midnight bg-white p-6 rounded-2xl w-full max-w-xs mx-auto relative shadow-2xl border border-white/10">
            <button onclick="window.closeModal('promoSettingsModal')" class="absolute top-3 right-3 text-gray-400 hover:text-red-500"><i class="ri-close-line text-xl"></i></button>
            <h3 class="text-lg font-bold mb-4 text-center dark:text-white text-slate-900 border-b border-gray-200 dark:border-white/10 pb-2">Pengaturan Promo</h3>
            <form id="promoForm" class="space-y-4">
                <div>
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Judul Promo</label>
                    <input type="text" id="promoTitleInput" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan" placeholder="Diskon Spesial!">
                </div>
                <div>
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Deskripsi Diskon</label>
                    <input type="text" id="promoDescInput" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan" placeholder="Diskon 20% All Item">
                </div>
                <div>
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Kode Voucher</label>
                    <input type="text" id="promoCodeInput" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan" placeholder="FAZA20">
                </div>

                <!-- ADDED: RADIO BUTTONS FOR DATE SELECTION -->
                <div class="flex gap-4 mb-2">
                    <label class="flex items-center gap-2 text-xs text-gray-500 cursor-pointer">
                        <input type="radio" name="promoType" value="today" class="accent-accent-cyan" checked onchange="toggleDateInput(this.value)">
                        <span id="todayLabelText">Hari Ini</span>
                    </label>
                    <label class="flex items-center gap-2 text-xs text-gray-500 cursor-pointer">
                        <input type="radio" name="promoType" value="custom" class="accent-accent-cyan" onchange="toggleDateInput(this.value)">
                        Pilih Tanggal
                    </label>
                </div>

                <!-- DATE INPUT (Initially Hidden) -->
                <div id="dateInputWrapper" class="hidden">
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Tanggal Berakhir</label>
                    <input type="date" id="promoDateInput" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan">
                </div>

                <!-- Time Limit Input -->
                <div>
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Jam Berakhir</label>
                    <input type="time" id="promoTimeInput" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan">
                </div>

                <div class="flex items-center justify-between bg-gray-100 dark:bg-white/5 p-2 rounded-lg">
                    <label class="text-xs text-gray-500 block font-bold">Status Promo</label>
                    <div class="flex items-center gap-2">
                        <span class="text-xs">Off</span>
                        <input type="checkbox" id="promoActiveInput" class="w-5 h-5 accent-accent-cyan rounded cursor-pointer">
                        <span class="text-xs font-bold text-accent-cyan">On</span>
                    </div>
                </div>
                <button type="submit" class="w-full py-2.5 bg-accent-yellow text-black rounded-lg font-bold hover:bg-yellow-500 transition-all text-sm shadow-lg hover:-translate-y-0.5 transform">Simpan Pengaturan</button>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-entry">
        <div class="glass p-8 rounded-2xl w-full max-w-xs mx-auto relative dark:bg-black/60 bg-white shadow-2xl border border-white/10">
            <button onclick="window.closeModal('loginModal')" class="absolute top-3 right-3 text-gray-400 hover:text-red-500"><i class="ri-close-line text-xl"></i></button>
            <div class="text-center mb-6">
                <div class="w-12 h-12 bg-accent-cyan/10 rounded-full flex items-center justify-center mx-auto mb-3 text-accent-cyan">
                    <i class="ri-lock-password-line text-2xl"></i>
                </div>
                <h3 class="text-lg font-bold dark:text-white text-slate-900">Admin Login</h3>
                <p class="text-xs text-gray-500">Masukkan akses khusus pemilik.</p>
            </div>
            <form id="adminForm" class="space-y-4">
                <div class="relative">
                    <input type="password" id="adminPass" class="w-full pl-4 pr-10 py-3 rounded-xl dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan focus:outline-none dark:text-white text-slate-900 text-sm transition-all" placeholder="Password">
                    <button type="button" onclick="togglePassword()" class="absolute right-3 top-3 text-gray-500 hover:text-accent-cyan"><i id="eyeIcon" class="ri-eye-line text-lg"></i></button>
                </div>
                <button type="submit" class="w-full py-3 bg-accent-cyan text-white rounded-xl font-bold hover:bg-cyan-600 transition-all text-sm shadow-lg hover:shadow-cyan-500/25">Login System</button>
            </form>
        </div>
    </div>

    <!-- Edit/Add Modal (Updated for Rich Description) -->
    <div id="editModal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/90 backdrop-blur-sm p-4 animate-entry">
        <div class="glass dark:bg-midnight bg-white p-6 rounded-2xl w-full max-w-md mx-auto relative shadow-2xl max-h-[90vh] overflow-y-auto border border-white/10">
            <button onclick="window.closeModal('editModal')" class="absolute top-3 right-3 text-gray-400 hover:text-red-500"><i class="ri-close-line text-xl"></i></button>
            <h3 id="modalFormTitle" class="text-lg font-bold mb-4 text-center dark:text-white text-slate-900 border-b border-gray-200 dark:border-white/10 pb-2">Edit Produk</h3>
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editId">
                <div class="w-full h-40 bg-gray-200 dark:bg-black/30 rounded-lg overflow-hidden flex items-center justify-center border border-gray-500/30 relative group">
                    <div id="editPreviewContainer" class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-700 to-gray-900">
                        <!-- Preview content injected via JS -->
                    </div>
                    <div id="previewPlaceholder" class="absolute flex flex-col items-center text-gray-400 pointer-events-none">
                        <i class="ri-image-add-line text-3xl mb-1"></i>
                        <span class="text-[10px]">Preview</span>
                    </div>
                </div>
                <div class="space-y-2">
                    <label class="text-xs text-gray-500 block font-bold">Gambar (Upload/Paste/URL)</label>
                    <div id="dropZone" class="border-2 border-dashed border-gray-400 dark:border-gray-600 rounded-lg p-3 text-center transition-colors cursor-pointer relative hover:border-accent-cyan hover:bg-accent-cyan/5 group">
                        <input type="file" id="editImageFile" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="handleImageUpload(this.files[0])">
                        <div class="pointer-events-none group-hover:text-accent-cyan transition-colors">
                            <i class="ri-upload-cloud-2-line text-xl text-gray-400 group-hover:text-accent-cyan"></i>
                            <p class="text-[10px] text-gray-500 mt-1">Klik upload, Drag, atau <b>CTRL+V</b></p>
                        </div>
                    </div>
                    <div class="flex gap-2 items-center">
                        <span class="text-[10px] text-gray-400 font-bold">URL</span>
                        <input type="text" id="editImageUrl" placeholder="https://..." class="flex-1 px-3 py-1.5 rounded text-xs dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white focus:border-accent-cyan focus:outline-none" onchange="updatePreviewFromUrl(this.value)">
                    </div>
                </div>
                <div><label class="text-xs text-gray-500 mb-1 block font-bold">Judul Katalog</label><input type="text" id="editTitle" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan" required oninput="updatePreviewFromTitle(this.value)"></div>
                <div><label class="text-xs text-gray-500 mb-1 block font-bold">Harga</label><input type="text" id="editPrice" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan" required></div>
                <div>
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Deskripsi (HTML/CSS Support)</label>
                    <textarea id="editDesc" rows="8" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan font-mono text-xs" placeholder="<p>Deskripsi...</p>"></textarea>
                    <p class="text-[10px] text-gray-500">Tips: Gunakan tag HTML seperti &lt;h1&gt;, &lt;ul&gt;, &lt;strong&gt; untuk tampilan epik.</p>
                </div>
                <div>
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Link Detail (Opsional)</label>
                    <input type="text" id="editDetailLink" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan" placeholder="https://lynk.id/malikfaza">
                </div>
                <div>
                    <label class="text-xs text-gray-500 mb-1 block font-bold">Kategori</label>
                    <select id="editCategory" class="w-full px-3 py-2 rounded-lg dark:bg-black/30 bg-gray-100 border border-gray-300 dark:border-gray-600 dark:text-white text-slate-900 text-sm focus:outline-none focus:border-accent-cyan cursor-pointer">
                        <option value="app">Premium Apps</option>
                        <option value="gem">Tools/Gems</option>
                        <option value="class">Masterclass</option>
                        <option value="activation">Akun Premium</option>
                        <option value="invite">Undangan Digital</option>
                    </select>
                </div>
                <div class="flex gap-2 pt-2">
                    <button type="button" id="btnDeleteIndividual" onclick="window.deleteCurrentProduct()" class="hidden px-3 py-2 bg-red-600/10 text-red-500 border border-red-600/30 rounded-lg hover:bg-red-600 hover:text-white transition-colors"><i class="ri-delete-bin-line"></i></button>
                    <button type="submit" class="flex-1 py-2.5 bg-accent-green text-white rounded-lg font-bold hover:bg-green-600 transition-all text-sm shadow-lg hover:-translate-y-0.5 transform">Simpan Perubahan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Detail Modal (FULL SCREEN EPIC) -->
    <div id="productModal" class="fixed inset-0 z-[200] hidden bg-white dark:bg-midnight overflow-y-auto animate-entry">
        <!-- Sticky Close Button -->
        <button onclick="window.closeModal('productModal')" class="fixed top-6 right-6 z-[210] w-12 h-12 rounded-full bg-gray-100 dark:bg-white/10 text-slate-800 dark:text-white flex items-center justify-center hover:bg-red-500 hover:text-white transition-colors shadow-lg backdrop-blur">
            <i class="ri-close-line text-2xl"></i>
        </button>

        <div class="container mx-auto px-6 py-12 md:py-20 max-w-6xl">
            <div class="grid md:grid-cols-2 gap-12 items-start">
                
                <!-- Left: Image Sticky on Desktop -->
                <div class="sticky top-24">
                    <div id="modalVisualContainer" class="aspect-square rounded-3xl overflow-hidden shadow-2xl border border-gray-200 dark:border-white/10 bg-gray-100 dark:bg-black/30 relative group">
                        <!-- Content injected via JS -->
                    </div>
                    
                    <div class="mt-8 flex flex-col gap-4">
                        <div class="flex justify-between items-center bg-gray-100 dark:bg-white/5 p-4 rounded-xl border border-gray-200 dark:border-white/10">
                            <span class="text-sm font-bold text-gray-500 dark:text-gray-400">Harga Spesial</span>
                            <span id="modalPrice" class="text-2xl font-bold text-accent-cyan">Rp 0</span>
                        </div>
                        
                        <!-- ACTION BUTTONS: Side by Side on Desktop, Stacked on Mobile -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <a id="modalWaLink" href="#" target="_blank" class="w-full py-4 bg-green-600 hover:bg-green-700 text-white rounded-xl font-bold text-center flex items-center justify-center gap-2 shadow-lg shadow-green-500/20 transform hover:-translate-y-1 transition-all text-sm sm:text-xs md:text-sm">
                                <i class="ri-whatsapp-fill text-xl"></i> Beli via WA
                            </a>
                            <a href="#" id="modalDetailLink" target="_blank" class="w-full py-4 bg-accent-cyan hover:bg-cyan-600 text-white rounded-xl font-bold text-center flex items-center justify-center gap-2 shadow-lg shadow-cyan-500/20 transform hover:-translate-y-1 transition-all text-sm sm:text-xs md:text-sm">
                                <i class="ri-coupon-3-fill text-xl"></i> Gunakan Voucher
                            </a>
                        </div>
                        <p class="text-center text-[10px] text-gray-400">Pilih metode pembelian yang Anda sukai.</p>
                    </div>
                </div>

                <!-- Right: Epic Content -->
                <div class="relative">
                    <div class="mb-6">
                        <span id="modalCategory" class="inline-block px-3 py-1 bg-accent-cyan/10 text-accent-cyan text-xs font-bold uppercase tracking-wider rounded-full border border-accent-cyan/20 mb-3">Category</span>
                        <h1 id="modalTitle" class="text-4xl md:text-5xl font-heading font-extrabold text-slate-900 dark:text-white leading-tight mb-6">Product Title</h1>
                        <div class="w-20 h-1.5 bg-gradient-to-r from-accent-cyan to-accent-green rounded-full"></div>
                    </div>

                    <!-- Description Area (Supports HTML/CSS) -->
                    <div id="modalDesc" class="prose prose-lg dark:prose-invert max-w-none text-gray-600 dark:text-gray-300 epic-desc">
                        <!-- Content injected via JS -->
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Toast Notification (UPDATED with Error State) -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] opacity-0 pointer-events-none transition-all duration-300 transform translate-y-10">
        <div id="toastContent" class="glass bg-slate-900/90 text-white px-6 py-3 rounded-full shadow-2xl border border-white/10 flex items-center gap-3 backdrop-blur-md">
            <i id="toastIcon" class="ri-checkbox-circle-line text-green-400 text-xl"></i>
            <span id="toastMessage" class="font-bold text-sm tracking-wide">Berhasil!</span>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script type="module">
        // SUPABASE CONFIGURATION
        const supabaseUrl = 'https://alckihxwgcjhzxhiyehr.supabase.co';
        // Note: This is the publishable key provided by the user. 
        // In a real production app with sensitive data, ensure strict RLS policies.
        const supabaseKey = 'sb_publishable_RhLlXfR1XmKVpxW5LF_lvw_7-AMCCA_'; 
        
        let supabase = null;
        try {
            supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
            document.getElementById('dbStatus').innerHTML = '<span class="text-green-500 flex items-center gap-1"><i class="ri-cloud-fill"></i> Online (Supabase)</span>';
        } catch(e) {
            console.error("Supabase Init Error:", e);
            document.getElementById('dbStatus').innerText = 'Connection Failed';
        }

        // Mock Data Fallback / Initial Data (Jika DB Kosong/Error)
        let mockProducts = [
             { 
                 id: `free-prod-lynk`, 
                 category: 'app', 
                 title: `FREE DIGITAL PRODUCT`, 
                 price: 'GRATIS', 
                 img: "", // Empty for Initials
                 desc: `
                    <h2> Spesial Untukmu!</h2>
                    <p>Dapatkan akses ke produk digital eksklusif ini secara <strong>GRATIS</strong>. Cocok untuk menunjang produktivitasmu.</p>
                    <p><strong>Cara Klaim:</strong></p>
                    <ul>
                        <li>Klik tombol "Gunakan Voucher" di bawah.</li>
                        <li>Masuk ke halaman Lynk.id kami.</li>
                        <li>Cari produk berlabel gratis dan checkout ($0).</li>
                    </ul>
                 `, 
                 detailLink: 'https://lynk.id/malikfaza', 
                 order: -1 
             },
             // ... more items can be added here as default fallback
        ];
        
        const today = new Date();
        today.setHours(23, 59, 0, 0);
        
        // GLOBAL STATE
        let products = [];
        let promoData = { 
            code: "FAZA20", 
            active: false, 
            title: "Diskon Spesial!", 
            desc: "Potongan 20% All Item", 
            endTime: today.toISOString()
        };

        let sortableInstance = null;
        
        // --- DATA FETCHING FUNCTIONS ---
        async function fetchProducts() {
            if(!supabase) return;
            try {
                const { data, error } = await supabase.from('products').select('*').order('order', { ascending: true });
                if(error) throw error;
                if(data && data.length > 0) {
                    products = data;
                } else {
                    products = [...mockProducts]; // Fallback if empty
                }
                renderProducts();
            } catch(e) {
                console.warn("Fetch Products Error (Using Mock):", e.message);
                // Don't overwrite local changes immediately on fetch error if we have data
                if(products.length === 0) {
                    products = [...mockProducts];
                    renderProducts();
                }
            }
        }

        async function fetchPromo() {
            if(!supabase) return;
            try {
                // Assuming we store promo settings in a 'settings' table with id='promo' and value=json
                const { data, error } = await supabase.from('settings').select('value').eq('id', 'promo').single();
                if(error && error.code !== 'PGRST116') throw error; // PGRST116 is Row not found
                
                if(data && data.value) {
                    promoData = data.value;
                }
                renderPromoContent();
                updateTimer();
                if(promoData.active) setTimeout(window.showPromoBig, 1000);
            } catch(e) {
                console.warn("Fetch Promo Error:", e.message);
            }
        }

        // --- HELPER TO SAVE PRODUCTS ---
        async function saveProductToDB(product) {
            if(!supabase) return;
            // Ensure product object matches table columns
            const payload = {
                id: product.id,
                title: product.title,
                price: product.price,
                category: product.category,
                detailLink: product.detailLink || "",
                img: product.img || "",
                desc: product.desc || "",
                order: product.order || 0
            };
            const { error } = await supabase.from('products').upsert(payload);
            if(error) throw error;
        }

        async function savePromoToDB(data) {
            if(!supabase) return;
            const { error } = await supabase.from('settings').upsert({ id: 'promo', value: data });
            if(error) throw error;
        }

        // --- TRANSLATION DICTIONARY ---
        const translations = {
            id: {
                nav_home: "Beranda",
                nav_products: "Produk",
                nav_services: "Jasa",
                nav_contact: "Kontak",
                hero_title_1: "Upgrade",
                hero_highlight: "Kehidupan Digital",
                hero_desc: "Pusat tools premium, jasa kreatif, dan aset digital berkualitas tinggi. Tingkatkan produktivitas Anda sekarang.",
                cta_shop: "Lihat Katalog",
                cta_contact: "Hubungi Kami",
                section_products_title: "Katalog",
                section_products_subtitle: "Koleksi tools premium pilihan untuk kebutuhan digital Anda.",
                section_services_title: "Jasa",
                section_services_subtitle: "Solusi kreatif profesional untuk bisnis Anda.",
                contact_title: "Punya Ide Project?",
                contact_subtitle: "Mari Wujudkan.",
                contact_desc: "Isi formulir ini untuk terhubung langsung dengan kami. Pesan Anda akan otomatis diteruskan ke WhatsApp Admin untuk respon yang lebih cepat.",
                form_name: "Nama",
                form_message: "Pesan",
                form_btn: "Kirim via WhatsApp",
                toggle_form_open: "Buka Formulir Pesan",
                toggle_form_close: "Tutup Formulir"
            },
            en: {
                nav_home: "Home",
                nav_products: "Products",
                nav_services: "Services",
                nav_contact: "Contact",
                hero_title_1: "Upgrade Your",
                hero_highlight: "Digital Life",
                hero_desc: "Hub for premium tools, creative services, and high-quality digital assets. Boost your productivity now.",
                cta_shop: "Browse Catalog",
                cta_contact: "Contact Us",
                section_products_title: "Catalog",
                section_products_subtitle: "Curated premium tools for your digital needs.",
                section_services_title: "Services",
                section_services_subtitle: "Professional creative solutions for your business.",
                contact_title: "Have a Project?",
                contact_subtitle: "Let's Make It Happen.",
                contact_desc: "Fill out this form to connect with us. Your message will be forwarded to Admin WhatsApp for faster response.",
                form_name: "Name",
                form_message: "Message",
                form_btn: "Send via WhatsApp",
                toggle_form_open: "Open Contact Form",
                toggle_form_close: "Close Form"
            }
        };

        // --- PURCHASE NOTIFICATION DATA ---
        const purchaseNames = [
            "Budi dari Jakarta", "Siti dari Surabaya", "Andi dari Bandung", "Dewi dari Medan", "Eko dari Semarang", 
            "Fajar dari Makassar", "Gita dari Jogja", "Hadi dari Balikpapan", "Indah dari Denpasar", "Joko dari Malang",
            "Rina dari Bogor", "Dedi dari Tangerang", "Maya dari Bekasi", "Reza dari Depok", "Sari dari Solo",
            "Bayu dari Palembang", "Nina dari Padang", "Rudi dari Lampung", "Tari dari Lombok", "Agus dari Papua"
        ];
        const purchaseTimes = ["Baru saja", "1 menit yang lalu", "2 menit yang lalu", "Baru saja", "5 menit yang lalu"];

        // --- TESTIMONIAL DATA ---
        const testimonials = [
            {
                name: "Rian Photography",
                role: "User AI Studio",
                text: "Fitur edit foto All-in-One di AI Studio gokil abis! Sekali klik foto klien langsung jadi pro. Hemat waktu banget.",
                stars: 5
            },
            {
                name: "Sarah Amalia",
                role: "Content Creator",
                text: "Beli Bundling Fotoin ga nyesel. Aplikasi edit fotonya komplit, preset-nya estetik parah. Wajib punya buat stok konten.",
                stars: 5
            },
            {
                name: "Bunda Rajut",
                role: "Crafter",
                text: "Tools Gem Rajut bikin semangat berkarya lagi. Pola-polanya gampang diikutin, ngebantu banget buat pemula kayak saya.",
                stars: 5
            },
            {
                name: "Dimas Entrepreneur",
                role: "Alumni Kelas Lynk.id",
                text: "Abis ikut kelas Lynk.id, sekarang punya mini website sendiri yang keren. Traffic jualan langsung naik drastis!",
                stars: 5
            },
            {
                name: "Kiki Gamer",
                role: "Game Developer",
                text: "Kelas bikin Custom Gem isinya 'daging' semua. Sekarang udah bisa bikin aset custom gem sendiri buat kerjaan.",
                stars: 5
            },
            {
                name: "Toko Hijab Clara",
                role: "User Tools Si Koces",
                text: "Tools Si Koces ajaib! Kode CSS-nya bikin tampilan Lynk.id olshop aku jadi cantik banget, beda dari yang lain.",
                stars: 5
            },
            {
                name: "Bayu Desain",
                role: "Freelancer",
                text: "Tools Gem Si Jadit emang ahlinya bikin banner. Template-nya jago ngedit banget, klien aku suka semua hasilnya.",
                stars: 5
            },
            {
                name: "Rara & Tio",
                role: "Customer Undangan",
                text: "Pesen Undangan Digital di sini hasilnya elegan & mewah. Tamu-tamu banyak yang muji desainnya.",
                stars: 5
            },
            {
                name: "UMKM Berkah",
                role: "User Fotoin Produk",
                text: "Layanan 'Sulap Foto Produk'-nya beneran sihir! Foto produk rumahan jadi kayak hasil studio profesional.",
                stars: 5
            },
            {
                name: "Affiliate Juara",
                role: "User Fotoin Try On",
                text: "Fotoin Try On cocok banget buat affiliate. try on-nya realistis, jagonya bikin try on yang konversinya tinggi!",
                stars: 5
            }
        ];

        // --- GLOBAL HELPER FUNCTIONS ---
        const gradients = [
            "from-blue-400 to-indigo-600",
            "from-emerald-400 to-cyan-600",
            "from-orange-400 to-pink-600",
            "from-purple-400 to-blue-600",
            "from-pink-400 to-rose-600",
            "from-yellow-400 to-orange-600",
            "from-teal-400 to-green-600",
            "from-cyan-400 to-blue-600"
        ];

        function getProductVisualHtml(product) {
            if (product.img && product.img.startsWith('data:image')) {
                 return `<img src="${product.img}" alt="${product.title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">`;
            } else if (product.img && product.img.startsWith('http')) {
                 return `<img src="${product.img}" alt="${product.title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">`;
            } else {
                // Initials fallback
                const initial = product.title.charAt(0).toUpperCase();
                const gradIndex = product.title.length % gradients.length;
                const gradClass = gradients[gradIndex];
                
                return `
                <div class="w-full h-full bg-gradient-to-br ${gradClass} flex items-center justify-center transition-transform duration-500 group-hover:scale-110">
                    <span class="text-6xl font-heading font-bold text-white/90 drop-shadow-lg">${initial}</span>
                </div>
                `;
            }
        }
        
        const handleImageUpload = (file) => {
            if (file && file.size < 5*1024*1024) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width, height = img.height;
                        const MAX_W = 800;
                        if(width > MAX_W) { height *= MAX_W/width; width = MAX_W; }
                        canvas.width = width; canvas.height = height;
                        canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                        const data = canvas.toDataURL('image/jpeg', 0.7);
                        
                        // Update preview container
                        const previewContainer = document.getElementById('editPreviewContainer');
                        previewContainer.innerHTML = `<img src="${data}" class="w-full h-full object-cover">`;
                        document.getElementById('previewPlaceholder').style.display = "none";
                        
                        // Store temp
                        window.tempUploadedImage = data;
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        };

        const updatePreviewFromUrl = (v) => { 
            if(v) { 
                const previewContainer = document.getElementById('editPreviewContainer');
                previewContainer.innerHTML = `<img src="${v}" class="w-full h-full object-cover">`;
                document.getElementById('previewPlaceholder').style.display = "none";
            } 
        };

        // Used for live typing title update to initials
        window.updatePreviewFromTitle = (val) => {
            const currentImg = document.getElementById('editImageUrl').value;
            if(!currentImg && !window.tempUploadedImage) {
                 const initial = val.charAt(0).toUpperCase();
                 const gradIndex = val.length % gradients.length;
                 const gradClass = gradients[gradIndex];
                 const previewContainer = document.getElementById('editPreviewContainer');
                 previewContainer.innerHTML = `
                    <div class="w-full h-full bg-gradient-to-br ${gradClass} flex items-center justify-center">
                        <span class="text-6xl font-heading font-bold text-white/90 drop-shadow-lg">${initial}</span>
                    </div>
                 `;
                 document.getElementById('previewPlaceholder').style.display = "none";
            }
        }

        const handlePasteImage = (e) => {
            if(document.getElementById('editModal').classList.contains('hidden')) return;
            const items = (e.clipboardData || e.originalEvent.clipboardData).items;
            for (let index in items) {
                const item = items[index];
                if (item.kind === 'file' && item.type.startsWith('image/')) {
                    const blob = item.getAsFile();
                    handleImageUpload(blob);
                }
            }
        };
        
        // --- TOAST FUNCTION ---
        window.showToast = (message, isError = false) => {
            const toast = document.getElementById('toast');
            const toastContent = document.getElementById('toastContent');
            const icon = document.getElementById('toastIcon');
            const msgEl = document.getElementById('toastMessage');
            
            msgEl.innerText = message;
            
            if (isError) {
                toastContent.classList.remove('bg-slate-900/90');
                toastContent.classList.add('bg-red-600/90'); 
                icon.className = 'ri-error-warning-line text-white text-xl';
            } else {
                toastContent.classList.remove('bg-red-600/90');
                toastContent.classList.add('bg-slate-900/90'); 
                icon.className = 'ri-checkbox-circle-line text-green-400 text-xl';
            }

            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 2500);
        }

        // --- LIVE PURCHASE NOTIFICATION LOGIC ---
        function showPurchaseNotification() {
            const toast = document.getElementById('purchaseToast');
            const nameEl = document.getElementById('purchaseName');
            const productEl = document.getElementById('purchaseProduct');
            const timeEl = document.getElementById('purchaseTime');
            const avatarEl = document.getElementById('purchaseAvatar');

            const randomName = purchaseNames[Math.floor(Math.random() * purchaseNames.length)];
            
            let randomProductTitle = "Premium Digital Product"; 
            const sourceProducts = (products && products.length > 0) ? products : mockProducts;
            
            if (sourceProducts.length > 0) {
                const product = sourceProducts[Math.floor(Math.random() * sourceProducts.length)];
                randomProductTitle = product.title;
            }

            const randomTime = purchaseTimes[Math.floor(Math.random() * purchaseTimes.length)];
            
            nameEl.innerText = randomName; 
            productEl.innerText = randomProductTitle;
            timeEl.innerText = randomTime;
            avatarEl.innerText = randomName.charAt(0); 

            toast.classList.remove('opacity-0', 'translate-y-[200%]', 'pointer-events-none');
            
            setTimeout(() => {
                hidePurchaseNotification();
            }, 5000);
        }

        window.hidePurchaseNotification = () => {
            const toast = document.getElementById('purchaseToast');
            toast.classList.add('opacity-0', 'translate-y-[200%]', 'pointer-events-none');
        };

        function scheduleNextNotification() {
            setTimeout(() => {
                showPurchaseNotification();
                scheduleRecursiveNotification();
            }, 5000);
        }

        function scheduleRecursiveNotification() {
             const interval = Math.floor(Math.random() * (80000 - 30000 + 1) + 30000);
             setTimeout(() => {
                 showPurchaseNotification();
                 scheduleRecursiveNotification();
             }, interval);
        }

        // --- COPY FUNCTION ---
        window.copyToClipboard = (text) => {
            const finalText = text || document.getElementById('promoCodeDisplay').innerText;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(finalText).then(() => {
                    window.showToast(`Kode "${finalText}" Tersalin!`);
                }).catch(err => {
                    fallbackCopyTextToClipboard(finalText);
                });
            } else {
                fallbackCopyTextToClipboard(finalText);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                var successful = document.execCommand('copy');
                if(successful) window.showToast(`Kode "${text}" Tersalin!`);
                else prompt("Salin manual:", text);
            } catch (err) {
                prompt("Salin manual:", text);
            }
            document.body.removeChild(textArea);
        }

        // Attach to Window
        window.handleImageUpload = handleImageUpload;
        window.updatePreviewFromUrl = updatePreviewFromUrl;

        const categories = [
            { id: 'all', label: 'All' },
            { id: 'app', label: 'Apps' },
            { id: 'gem', label: 'Tools' },
            { id: 'class', label: 'Kelas' },
            { id: 'activation', label: 'Akun' },
            { id: 'invite', label: 'Undangan' }
        ];

        const services = [
            { id: 'srv-1', icon: 'ri-video-add-line', title: 'Video Editing', desc: 'Cinematic & Reels', color: 'text-accent-red', border: 'border-accent-red' },
            { id: 'srv-2', icon: 'ri-image-edit-line', title: 'Photo Retouch', desc: 'Pro Grading & Manipulation', color: 'text-accent-cyan', border: 'border-accent-cyan' },
            { id: 'srv-3', icon: 'ri-brush-line', title: 'Banner Design', desc: 'Ads High Convert', color: 'text-accent-orange', border: 'border-accent-orange' },
            { id: 'srv-4', icon: 'ri-layout-masonry-line', title: 'Landing Page', desc: 'Responsive Web Design', color: 'text-accent-green', border: 'border-accent-green' },
            { id: 'srv-5', icon: 'ri-camera-lens-line', title: 'Product Photo', desc: 'High Quality Studio', color: 'text-accent-yellow', border: 'border-accent-yellow' },
            { id: 'srv-6', icon: 'ri-booklet-line', title: 'Catalog', desc: 'Menu & Brochure', color: 'text-gray-400', border: 'border-gray-400' }
        ];

        let activeCategory = 'all';
        let isAdmin = localStorage.getItem('malikAdmin') === 'true';
        let selectedIds = new Set();
        let promoHasShown = false;
        let currentLang = 'id'; 

        // --- TIMER UPDATE FUNCTION (UPDATED) ---
        const updateTimer = () => {
             const now = new Date();
             
             // Parse ISO String from promoData.endTime
             let target;
             if (promoData.endTime && promoData.endTime.includes("T")) {
                 // Full ISO string
                 target = new Date(promoData.endTime);
             } else {
                 // Fallback for old "HH:mm" format (treat as today)
                 const [endHour, endMinute] = (promoData.endTime || "23:59").split(':');
                 target = new Date();
                 target.setHours(endHour, endMinute, 0);
             }
             target.setSeconds(0);
             
             if (now > target) {
                   document.querySelectorAll('.promoTimer').forEach(el => el.innerText = "00:00:00");
                   
                   const container = document.getElementById('promoContainer');
                   if (!container.classList.contains('promo-hidden')) {
                       window.closePromoCompletely();
                   }
                   return;
             }
             
             const diff = target - now;
             const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
             const minutes = Math.floor((diff / 1000 / 60) % 60);
             const seconds = Math.floor((diff / 1000) % 60);
             
             // Total hours calculation for display (e.g. 48:00:00 if > 1 day)
             const totalHours = Math.floor(diff / (1000 * 60 * 60));
             
             document.querySelectorAll('.promoTimer').forEach(el => el.innerText = `${totalHours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`);
        };

        window.addEventListener('DOMContentLoaded', async () => {
            renderCategories();
            renderProducts(); // Initially render mock if any
            renderServices();
            renderTestimonials();
            renderPromoContent();
            checkAdminState();
            updateLanguage(currentLang);
            scheduleNextNotification(); 
            
            // Fetch real data
            await fetchProducts();
            await fetchPromo();

            setTimeout(() => { if(window.AOS) window.AOS.init({ once: true, duration: 800 }); }, 500);
            window.addEventListener('paste', handlePasteImage);
            
            document.getElementById('btnDelete').addEventListener('click', deleteSelected);
            document.getElementById('btnReset').addEventListener('click', uploadDefaultData);
            document.getElementById('btnAdd').addEventListener('click', openAddModal);
            
            document.getElementById('langToggle').addEventListener('click', () => {
                currentLang = currentLang === 'id' ? 'en' : 'id';
                document.getElementById('langToggle').innerText = currentLang.toUpperCase();
                updateLanguage(currentLang);
            });

            // Promo Logic
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.1 
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if(entry.isIntersecting && !promoHasShown) {
                        const now = new Date();
                        let target;
                        if (promoData.endTime && promoData.endTime.includes("T")) {
                            target = new Date(promoData.endTime);
                        } else {
                            const [endHour, endMinute] = (promoData.endTime || "23:59").split(':');
                            target = new Date();
                            target.setHours(endHour, endMinute, 0);
                        }
                        target.setSeconds(0);

                        if(promoData.active && now <= target) {
                            promoHasShown = true; 
                            setTimeout(() => { window.showPromoBig(); }, 800); 
                            observer.disconnect(); 
                        }
                    }
                });
            }, observerOptions);
            
            const prodSec = document.getElementById('products');
            if(prodSec) observer.observe(prodSec);
            
            setInterval(updateTimer, 1000);
            updateTimer();
        });
        
        function updateLanguage(lang) {
            const t = translations[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerText = t[key];
            });
            const toggleText = document.querySelector('#toggleFormBtn span');
            if(toggleText) {
                const formWrapper = document.getElementById('formWrapper');
                const isOpen = formWrapper.classList.contains('open');
                toggleText.innerText = isOpen ? t.toggle_form_close : t.toggle_form_open;
            }
        }

        // --- TOGGLE DATE INPUT ---
        window.toggleDateInput = (val) => {
            const dateWrapper = document.getElementById('dateInputWrapper');
            if(val === 'custom') {
                dateWrapper.classList.remove('hidden');
            } else {
                dateWrapper.classList.add('hidden');
            }
        }

        function renderPromoContent() {
            let endTimeStr = promoData.endTime || "23:59";
            let displayDate = "";
            let displayTime = "";
            
            const now = new Date();
            const options = { day: 'numeric', month: 'short' };
            const todayStr = now.toLocaleDateString('id-ID', options);

            // Check if ISO string
            if(endTimeStr.includes("T")) {
                const targetDate = new Date(endTimeStr);
                const targetDateStr = targetDate.toLocaleDateString('id-ID', options);
                
                // Format Time
                const hours = targetDate.getHours().toString().padStart(2, '0');
                const minutes = targetDate.getMinutes().toString().padStart(2, '0');
                displayTime = `${hours}:${minutes}`;

                // Determine Date Label
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                if (targetDate.toDateString() === now.toDateString()) {
                    displayDate = targetDateStr; 
                } else if (targetDate.toDateString() === tomorrow.toDateString()) {
                    displayDate = "Besok " + targetDateStr;
                } else {
                    displayDate = targetDateStr;
                }
            } else {
                // Fallback for simple time string
                displayDate = todayStr;
                displayTime = endTimeStr;
            }
            
            const dateTextEl = document.getElementById('promoDateText');
            if(dateTextEl) dateTextEl.innerText = `Promo Spesial ${displayDate} s/d Pukul ${displayTime}`;
            
            document.getElementById('promoCodeDisplay').innerText = promoData.code;
            document.getElementById('promoTitleDisplay').innerText = promoData.title || "Diskon Spesial!";
            document.getElementById('promoDescDisplay').innerText = promoData.desc || "Potongan 20% All Item";
        }

        window.toggleContactForm = () => {
            const formWrapper = document.getElementById('formWrapper');
            const icon = document.getElementById('toggleIcon');
            const btnText = document.querySelector('#toggleFormBtn span');
            const t = translations[currentLang];
            formWrapper.classList.toggle('open');
            if (formWrapper.classList.contains('open')) {
                icon.style.transform = 'rotate(180deg)';
                btnText.innerText = t.toggle_form_close;
            } else {
                icon.style.transform = 'rotate(0deg)';
                btnText.innerText = t.toggle_form_open;
            }
        };

        window.handleSearch = (query) => {
            if(!query) { renderProducts(); return; }
            const lowerQuery = query.toLowerCase();
            const filtered = products.filter(p => 
                p.title.toLowerCase().includes(lowerQuery) || 
                p.category.toLowerCase().includes(lowerQuery)
            );
            renderFilteredProducts(filtered);
        };

        window.sendToWhatsapp = (e) => {
            e.preventDefault();
            const name = document.getElementById('contactName').value;
            const message = document.getElementById('contactMessage').value;
            const waNumber = "6285161141114";
            const text = `*Halo Malikfaza Studio,*%0A%0ASaya ingin menghubungi Anda.%0A%0A*Detail Pengirim:*%0ANama: ${name}%0A%0A*Pesan:*%0A${message}`;
            const url = `https://wa.me/${waNumber}?text=${text}`; 
            window.open(url, '_blank');
        };

        window.openPromoSettings = () => {
            document.getElementById('promoTitleInput').value = promoData.title || "";
            document.getElementById('promoDescInput').value = promoData.desc || "";
            document.getElementById('promoCodeInput').value = promoData.code;
            document.getElementById('promoActiveInput').checked = promoData.active;
            
            // Add date to "Hari Ini" label
            const todayLabel = document.getElementById('todayLabelText');
            if(todayLabel) {
                const d = new Date();
                todayLabel.innerText = `Hari Ini (${d.toLocaleDateString('id-ID', {day: 'numeric', month: 'short'})})`;
            }
            
            // Handle Date/Time Inputs based on current promoData
            let currentEnd = promoData.endTime;
            if(!currentEnd) currentEnd = new Date().toISOString(); // Default to now if missing
            
            // Check if it's a full ISO string
            if(currentEnd.includes("T")) {
                 const dateObj = new Date(currentEnd);
                 // Adjust for timezone offset for input value
                 // Input type="date" expects YYYY-MM-DD in local time usually, but Date object is UTC based or local based depending on construction
                 // Simple approach: Use local string split
                 const dateStr = dateObj.toLocaleDateString('en-CA'); // YYYY-MM-DD
                 const timeStr = dateObj.toTimeString().slice(0,5);
                 
                 // Check if date is today
                 const now = new Date();
                 const todayStr = now.toLocaleDateString('en-CA');
                 
                 if(dateStr === todayStr) {
                     // Set to Today mode
                     document.querySelector('input[name="promoType"][value="today"]').checked = true;
                     toggleDateInput('today');
                 } else {
                     // Set to Custom mode
                     document.querySelector('input[name="promoType"][value="custom"]').checked = true;
                     toggleDateInput('custom');
                     document.getElementById('promoDateInput').value = dateStr;
                 }
                 document.getElementById('promoTimeInput').value = timeStr;
            } else {
                 // Fallback old format (only time)
                 document.querySelector('input[name="promoType"][value="today"]').checked = true;
                 toggleDateInput('today');
                 document.getElementById('promoTimeInput').value = currentEnd;
            }

            document.getElementById('promoSettingsModal').classList.remove('hidden');
            document.getElementById('promoSettingsModal').classList.add('flex');
        };

        document.getElementById('promoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const newTitle = document.getElementById('promoTitleInput').value;
            const newDesc = document.getElementById('promoDescInput').value;
            const newCode = document.getElementById('promoCodeInput').value;
            const isActive = document.getElementById('promoActiveInput').checked;
            
            // Construct Date Time
            const type = document.querySelector('input[name="promoType"]:checked').value;
            const timeVal = document.getElementById('promoTimeInput').value || "23:59";
            let dateVal = "";
            
            if(type === 'today') {
                // Use local date YYYY-MM-DD
                dateVal = new Date().toLocaleDateString('en-CA');
            } else {
                dateVal = document.getElementById('promoDateInput').value;
                if(!dateVal) dateVal = new Date().toLocaleDateString('en-CA'); 
            }
            
            // Combine to ISO String
            const fullDateTime = `${dateVal}T${timeVal}:00`;
            
            const newData = { title: newTitle, desc: newDesc, code: newCode, endTime: fullDateTime, active: isActive };
            
            promoData = newData;

            // OPTIMISTIC UI: Render immediately
            renderPromoContent();
            updateTimer();
            if(isActive) window.showPromoBig(); else window.closePromoCompletely();
            window.closeModal('promoSettingsModal');

            // SYNC
            try {
                await savePromoToDB(newData);
                window.showToast("Promo Tersimpan (Publik)");
            } catch(e) {
                console.error(e);
                window.showToast("Tersimpan Lokal (Gagal Sync Publik)", true);
            }
        });

        // FIXED: Using 'promo-hidden' instead of 'hidden' to match CSS transitions
        window.showPromoBig = () => {
            const container = document.getElementById('promoContainer');
            container.classList.remove('promo-hidden'); 
            container.classList.add('promo-mode-big');
            container.classList.remove('promo-mode-mini');
        };
        window.minimizePromo = () => {
            const container = document.getElementById('promoContainer');
            container.classList.remove('promo-mode-big');
            container.classList.add('promo-mode-mini');
        };
        window.maximizePromo = () => {
            const container = document.getElementById('promoContainer');
            container.classList.add('promo-mode-big');
            container.classList.remove('promo-mode-mini');
        };
        window.closePromoCompletely = () => {
            const container = document.getElementById('promoContainer');
            container.classList.add('promo-hidden');
        };
        
        function openAddModal() {
            document.getElementById('editForm').reset();
            document.getElementById('editId').value = "";
            document.getElementById('modalFormTitle').innerText = "Tambah Produk Baru";
            document.getElementById('editPreviewContainer').innerHTML = ""; // Clear preview
            document.getElementById('previewPlaceholder').style.display = "flex";
            document.getElementById('editImageFile').value = "";
            document.getElementById('btnDeleteIndividual').classList.add('hidden');
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }
        window.openAddModal = openAddModal;

        async function uploadDefaultData() {
            if(!confirm("Hapus semua dan reset ke data awal?")) return;
            // Since we are connected to Supabase, "Reset" might be dangerous.
            // Let's just reload mocked data into local state OR push mock data to DB?
            // Safer to just reload UI with mock for now, but user asked for DB connection.
            // Let's implement a 'Reseed DB' logic.
            
            if(!supabase) {
                products = [...mockProducts];
                renderProducts();
                window.showToast("Reset Data Lokal Berhasil");
                return;
            }

            const btn = document.getElementById('btnReset');
            btn.innerText = '...'; btn.disabled = true;

            try {
                // Delete all rows (danger!)
                // In real app, maybe just upsert defaults.
                for(const p of mockProducts) {
                    await saveProductToDB(p);
                }
                await fetchProducts();
                window.showToast("Database seeded with default data!");
            } catch(e) {
                console.error(e);
                window.showToast("Error Seeding DB", true);
            } finally {
                btn.innerHTML = '<i class="ri-refresh-line text-base"></i> Reset Data'; btn.disabled = false; 
            }
        };

        window.toggleSelect = (id) => {
            const card = document.getElementById(`card-${id}`);
            if (selectedIds.has(id)) {
                selectedIds.delete(id);
                if(card) card.classList.remove('card-selected');
            } else {
                selectedIds.add(id);
                if(card) card.classList.add('card-selected');
            }
        };

        async function deleteSelected() {
            if (selectedIds.size === 0) return alert("Pilih produk dulu dengan checklist.");
            if(!confirm(`Hapus ${selectedIds.size} produk terpilih?`)) return;
            
            // 1. OPTIMISTIC UI: Remove locally first
            products = products.filter(p => !selectedIds.has(p.id));
            renderProducts();
            
            if(!supabase) {
                window.showToast("Produk dihapus (Lokal)");
                selectedIds.clear();
                return;
            }

            try {
                const idsToDelete = Array.from(selectedIds);
                const { error } = await supabase.from('products').delete().in('id', idsToDelete);
                if(error) throw error;
                
                // No need to fetch again if optimistic update matches
                window.showToast("Produk dihapus dari Supabase");
                selectedIds.clear();
            } catch(e) {
                console.error(e);
                // In a perfect world, we would revert the deletion here
                window.showToast("Tersimpan Lokal (Gagal Hapus Publik)", true);
            }
        };
        window.deleteSelected = deleteSelected;
        window.uploadDefaultData = uploadDefaultData;

        let isPlaying = false;
        window.toggleMusic = () => {
            const music = document.getElementById('bgMusic');
            const icon = document.getElementById('musicIcon');
            if(isPlaying) {
                music.pause();
                icon.classList.remove('ri-pause-circle-line');
                icon.classList.add('ri-music-2-line');
            } else {
                music.play().catch(e => console.log("Audio autoplay policy restricted"));
                icon.classList.remove('ri-music-2-line');
                icon.classList.add('ri-pause-circle-line');
            }
            isPlaying = !isPlaying;
        };
        window.startMusic = () => {
             if(!isPlaying) window.toggleMusic();
        };

        function renderCategories() {
            const container = document.getElementById('categoryFilters');
            container.innerHTML = categories.map(cat => `
                <button onclick="window.filterCategory('${cat.id}')" class="shrink-0 px-5 py-2 rounded-full text-xs font-bold transition-all border ${activeCategory === cat.id ? 'bg-accent-cyan text-white border-accent-cyan shadow-lg shadow-cyan-500/30' : 'bg-white dark:bg-white/5 border-gray-200 dark:border-white/10 text-gray-500 dark:text-gray-400 hover:border-accent-cyan hover:text-accent-cyan'}">${cat.label}</button>
            `).join('');
        }

        window.filterCategory = (catId) => {
            activeCategory = catId;
            renderCategories();
            renderProducts();
        };

        // --- SORTABLE INIT LOGIC ---
        function initSortable() {
            const el = document.getElementById('productContainer');
            if (sortableInstance) sortableInstance.destroy();
            
            if (isAdmin && activeCategory === 'all') { 
                sortableInstance = new Sortable(el, {
                    animation: 150,
                    delay: 200, 
                    delayOnTouchOnly: true,
                    ghostClass: 'sortable-ghost',
                    dragClass: 'sortable-drag',
                    handle: '.aspect-square', // Drag handle area
                    onEnd: async function (evt) {
                        const newOrderIds = Array.from(el.children).map(card => card.getAttribute('data-id'));
                        
                        // Reorder locally first
                        const newProducts = [];
                        newOrderIds.forEach(id => {
                            const p = products.find(prod => prod.id === id);
                            if(p) newProducts.push(p);
                        });
                        products = newProducts;
                        products.forEach((p, idx) => p.order = idx);

                        // Sync to Supabase
                        if(supabase) {
                            // Supabase doesn't have a bulk update in one go easily without loop or custom function
                            // For UI responsiveness, we assume success. 
                            // For robustness, we loop.
                            for(let i=0; i<products.length; i++) {
                                await supabase.from('products').update({ order: i }).eq('id', products[i].id);
                            }
                        }
                    }
                });
            }
        }

        // --- RENDER PRODUCTS IN GRID (UPDATED WA LINK LOGIC) ---
        function renderFilteredProducts(productList) {
             const container = document.getElementById('productContainer');
             container.innerHTML = productList.map((p, index) => {
                const animationDelay = index * 50;
                
                // FIX: Menambahkan Link Detail ke Pesan WA di Tombol Grid (Depan)
                // Sebelumnya hanya judul, sekarang lengkap dengan link
                const linkUrl = p.detailLink && p.detailLink.trim() !== "" ? p.detailLink : "https://lynk.id/malikfaza";
                const waText = `Halo Malikfaza, saya tertarik membeli produk ini:\n\n*${p.title}*\n\nLink Produk: ${linkUrl}`;
                const waLink = `https://wa.me/6285161141114?text=${encodeURIComponent(waText)}`;

                const visualContent = getProductVisualHtml(p);

                return `
                <div data-id="${p.id}" id="card-${p.id}" class="w-full glass rounded-2xl overflow-hidden group relative border border-gray-200 dark:border-white/5 flex flex-col snap-start card-interactive animate-entry bg-white dark:bg-white/5" style="animation-delay: ${animationDelay}ms">
                    <div class="aspect-square w-full overflow-hidden relative bg-gray-100 dark:bg-gray-800">
                        ${visualContent}
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <span class="absolute top-3 left-3 bg-black/40 backdrop-blur-md text-[9px] font-bold px-2 py-1 rounded text-white border border-white/20 uppercase tracking-widest">${p.category}</span>
                        ${isAdmin ? `<div class="absolute top-2 right-2 z-40 flex flex-col gap-2 items-end" onclick="event.stopPropagation()"><input type="checkbox" onchange="window.toggleSelect('${p.id}')" class="custom-checkbox w-5 h-5 rounded border-gray-300 bg-white cursor-pointer accent-red-500 shadow-md"><button onclick="window.openEditModal('${p.id}')" class="bg-white text-slate-900 w-8 h-8 rounded-full flex items-center justify-center shadow-lg border border-gray-100 hover:bg-accent-cyan hover:text-white transition-colors"><i class="ri-pencil-fill text-sm"></i></button></div>` : ''}
                    </div>
                    <div class="p-4 flex flex-col h-full justify-between flex-1 relative">
                        <div>
                            <h3 id="title-${p.id}" class="card-title font-bold text-sm md:text-base mb-1 truncate leading-tight">${p.title}</h3>
                            <p id="price-${p.id}" class="text-accent-cyan font-bold text-xs md:text-sm flex items-center gap-1"><i class="ri-price-tag-3-fill"></i> ${p.price}</p>
                        </div>
                        <div class="flex gap-2 mt-4 pt-4 border-t border-gray-100 dark:border-white/5">
                             <button onclick="window.openProductModal('${p.id}')" class="flex-1 bg-transparent hover:bg-gray-100 dark:hover:bg-white/10 text-slate-500 dark:text-gray-300 text-[10px] md:text-xs py-2 rounded-lg transition-colors font-bold border border-gray-200 dark:border-white/10">Detail</button>
                            <a href="${waLink}" target="_blank" class="flex-1 bg-green-600 hover:bg-green-700 text-white text-[10px] md:text-xs py-2 rounded-lg transition-all font-bold text-center flex items-center justify-center gap-1 shadow-lg shadow-green-500/20"><i class="ri-whatsapp-fill"></i> Beli</a>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            initSortable();
        }

        function renderProducts() {
            const filtered = activeCategory === 'all' ? products : products.filter(p => p.category === activeCategory);
            renderFilteredProducts(filtered);
        }

        function renderServices() {
            const container = document.getElementById('serviceContainer');
            container.innerHTML = services.map((s, i) => `
                <a href="https://lynk.id/malikfaza" target="_blank" class="block p-5 glass rounded-2xl hover:bg-white dark:hover:bg-white/10 transition-all border-l-4 ${s.border} shadow-sm group card-interactive bg-white dark:bg-white/5">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 rounded-full bg-gray-50 dark:bg-white/5 flex items-center justify-center ${s.color} group-hover:scale-110 transition-transform">
                            <i class="${s.icon} text-2xl"></i>
                        </div>
                        <i class="ri-arrow-right-up-line text-gray-400 group-hover:text-white transition-colors"></i>
                    </div>
                    <h3 class="text-base md:text-lg font-bold mb-2 dark:text-white text-slate-900 group-hover:text-accent-cyan transition-colors">${s.title}</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400 truncate leading-relaxed">${s.desc}</p>
                </a>
            `).join('');
        }

        // --- RENDER TESTIMONIALS (LOOP TECHNIQUE) ---
        function renderTestimonials() {
            const container = document.getElementById('testimonialContainer');
            
            // Generate HTML for one set of cards
            const cardsHtml = testimonials.map((t) => {
                // Stars removed, Avatar changed to Initials
                const initial = t.name.charAt(0);
                return `
                <div class="glass p-5 rounded-2xl border border-gray-200 dark:border-white/10 bg-white dark:bg-white/5 hover:border-accent-cyan/50 transition-colors shadow-lg relative min-w-[300px] max-w-[300px] flex-shrink-0 cursor-pointer">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-accent-cyan to-blue-600 flex items-center justify-center text-white font-bold text-sm shadow-md border border-white/20">
                            ${initial}
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-900 dark:text-white text-sm truncate w-40">${t.name}</h4>
                            <p class="text-[10px] text-accent-cyan font-bold uppercase tracking-wider">${t.role}</p>
                        </div>
                    </div>
                    <div class="relative">
                        <i class="ri-double-quotes-l absolute -top-1 -left-1 text-3xl text-gray-200 dark:text-white/5 -z-10"></i>
                        <p class="text-xs text-gray-600 dark:text-gray-300 italic leading-relaxed relative z-10 line-clamp-3">"${t.text}"</p>
                    </div>
                </div>
                `;
            }).join('');

            // Duplicate content for seamless loop (Original + Duplicate)
            container.innerHTML = cardsHtml + cardsHtml;
        }

        window.openProductModal = (id) => {
            const p = products.find(x => x.id === id);
            if(!p) return;
            
            // Handle Visual Content in Modal
            const visualHtml = getProductVisualHtml(p);
            const container = document.getElementById('modalVisualContainer');
            container.innerHTML = visualHtml;
            // Re-add gradient overlay which is lost when setting innerHTML
            container.insertAdjacentHTML('beforeend', '<div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>');

            document.getElementById('modalTitle').innerText = p.title;
            document.getElementById('modalPrice').innerText = p.price;
            
            // Allow HTML description rendering
            document.getElementById('modalDesc').innerHTML = p.desc;
            document.getElementById('modalCategory').innerText = p.category;
            
            const detailBtn = document.getElementById('modalDetailLink');
            // Gunakan link spesifik jika ada, jika kosong pakai link default
            const linkUrl = p.detailLink && p.detailLink.trim() !== "" ? p.detailLink : "https://lynk.id/malikfaza";
            detailBtn.href = linkUrl;
            
            // UPDATED WA MESSAGE LOGIC
            // Sekarang menyertakan Link Spesifik yang diinput di menu edit
            const waText = `Halo Malikfaza, saya tertarik membeli produk ini:\n\n*${p.title}*\n\nLink Produk: ${linkUrl}`;
            const waUrl = `https://wa.me/6285161141114?text=${encodeURIComponent(waText)}`;
            
            document.getElementById('modalWaLink').href = waUrl;
            document.getElementById('productModal').classList.remove('hidden');
            document.getElementById('productModal').classList.add('block');
        };

        // --- EDIT ---
        let tempImageBase64 = null;
        window.openEditModal = (id) => {
            const p = products.find(x => x.id === id);
            if(!p) return;
            tempImageBase64 = null;
            document.getElementById('editId').value = id;
            document.getElementById('editTitle').value = p.title;
            document.getElementById('editPrice').value = p.price;
            document.getElementById('editCategory').value = p.category;
            document.getElementById('editDetailLink').value = p.detailLink || "https://lynk.id/malikfaza";
            document.getElementById('editDesc').value = p.desc; // Load HTML description
            document.getElementById('modalFormTitle').innerText = "Edit Produk";
            
            // Set Preview
            if(p.img) {
                 const previewContainer = document.getElementById('editPreviewContainer');
                 previewContainer.innerHTML = `<img src="${p.img}" class="w-full h-full object-cover">`;
                 document.getElementById('previewPlaceholder').style.display = "none";
            } else {
                 // Trigger title based preview
                 window.updatePreviewFromTitle(p.title);
            }

            document.getElementById('btnDeleteIndividual').classList.remove('hidden');
            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        };

        window.deleteCurrentProduct = async () => {
            const id = document.getElementById('editId').value;
            if(!id || !confirm("Hapus produk ini?")) return;
            
            // 1. OPTIMISTIC UI
            products = products.filter(p => p.id !== id);
            renderProducts();
            
            if(supabase) {
                try {
                    const { error } = await supabase.from('products').delete().eq('id', id);
                    if(error) throw error;
                    // await fetchProducts(); // No need
                    window.showToast("Produk dihapus (Supabase)");
                } catch(e) {
                    window.showToast("Tersimpan Lokal (Gagal Hapus Publik)", true);
                }
            } else {
                window.showToast("Produk dihapus (Lokal)");
            }
            window.closeModal('editModal');
        };

        document.getElementById('editForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('editId').value;
            const pId = id ? id : 'prod-' + Date.now();
            
            // Get current image logic
            let finalImg = "";
            const urlVal = document.getElementById('editImageUrl').value;
            
            if (window.tempUploadedImage) {
                finalImg = window.tempUploadedImage;
            } else if (urlVal) {
                finalImg = urlVal;
            } else {
                const original = products.find(p => p.id === id);
                if(original) finalImg = original.img;
            }
            
            const newData = {
                id: pId,
                title: document.getElementById('editTitle').value,
                price: document.getElementById('editPrice').value,
                category: document.getElementById('editCategory').value,
                detailLink: document.getElementById('editDetailLink').value,
                img: finalImg,
                desc: document.getElementById('editDesc').value, // Save HTML description
                order: id ? (products.find(p=>p.id===id)?.order || 0) : products.length
            };
            
            // 1. OPTIMISTIC UI: UPDATE LOCAL STATE IMMEDIATELY
            const idx = products.findIndex(p => p.id === pId);
            if(idx > -1) products[idx] = newData;
            else products.push(newData);
            
            renderProducts();
            window.closeModal('editModal');
            window.tempUploadedImage = null; // Reset temp

            // 2. TRY SYNC TO SUPABASE
            if(supabase) {
                try {
                    await saveProductToDB(newData);
                    window.showToast("Berhasil Disimpan & Publik!");
                } catch(e) {
                    console.error("Sync Error:", e);
                    // Don't revert UI, just warn
                    window.showToast("Tersimpan di Perangkat (Gagal Upload ke Publik)", true);
                }
            } else {
                window.showToast("Tersimpan Offline");
            }
        });

        window.closeModal = (id) => {
            document.getElementById(id).classList.add('hidden');
            document.getElementById(id).classList.remove('flex');
            document.getElementById(id).classList.remove('block');
        };

        window.togglePassword = () => {
            const input = document.getElementById('adminPass');
            const icon = document.getElementById('eyeIcon');
            input.type = input.type === "password" ? "text" : "password";
            icon.classList.toggle('ri-eye-line');
            icon.classList.toggle('ri-eye-off-line');
        };

        const themeBtn = document.getElementById('themeToggle');
        themeBtn.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            document.documentElement.classList.toggle('light');
        });

        document.getElementById('adminLoginFooter').addEventListener('click', () => { if(!isAdmin) { document.getElementById('loginModal').classList.remove('hidden'); document.getElementById('loginModal').classList.add('flex'); } });
        document.getElementById('adminBtnMobile').addEventListener('click', () => { if(!isAdmin) { document.getElementById('loginModal').classList.remove('hidden'); document.getElementById('loginModal').classList.add('flex'); } });

        document.getElementById('adminForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if(document.getElementById('adminPass').value === 'malikfaza99') {
                isAdmin = true;
                localStorage.setItem('malikAdmin', 'true');
                checkAdminState();
                window.closeModal('loginModal');
                renderProducts(); 
                window.showToast("Welcome back, Master!");
            } else {
                // UPDATE: Menggunakan Toast Merah untuk Password Salah
                window.showToast("Password salah! Akses ditolak.", true);
            }
        });

        window.logoutAdmin = () => {
            isAdmin = false;
            localStorage.removeItem('malikAdmin');
            checkAdminState();
            renderProducts();
        };

        function checkAdminState() {
            const panel = document.getElementById('adminPanel');
            if(isAdmin) {
                panel.classList.remove('hidden');
                document.body.classList.add('admin-mode');
            } else {
                panel.classList.add('hidden');
                document.body.classList.remove('admin-mode');
            }
            initSortable();
        }
        
        // NEW EXPORT FUNCTION
        window.exportData = () => {
            const data = {
                products: products,
                promoSettings: promoData,
                exportedAt: new Date().toISOString(),
                note: "Import this JSON to restore data"
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `malikfaza_backup_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            window.showToast("Data berhasil diexport (JSON)!");
        };

        // NEW IMPORT FUNCTION (With Supabase Sync)
        window.importData = (inputElement) => {
            const file = inputElement.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = JSON.parse(e.target.result);

                    if (!data.products && !data.promoSettings) {
                        throw new Error("Format JSON tidak dikenali");
                    }

                    // Update Supabase
                    if (supabase) {
                        const batchPromises = [];
                        
                        if (data.products && Array.isArray(data.products)) {
                            // Supabase upsert expects columns to match exactly.
                            const formattedProducts = data.products.map(p => ({
                                id: p.id,
                                title: p.title,
                                price: p.price,
                                category: p.category,
                                detailLink: p.detailLink || "",
                                img: p.img || "",
                                desc: p.desc || "",
                                order: p.order || 0
                            }));
                            batchPromises.push(supabase.from('products').upsert(formattedProducts));
                        }

                        if (data.promoSettings) {
                             batchPromises.push(savePromoToDB(data.promoSettings));
                        }

                        await Promise.all(batchPromises);
                        await fetchProducts();
                        await fetchPromo();
                        window.showToast(`Import Berhasil! Database Diperbarui.`);
                    } else {
                        // Local Fallback
                        if(data.products) products = data.products;
                        if(data.promoSettings) promoData = data.promoSettings;
                        renderProducts();
                        renderPromoContent();
                        window.showToast("Import Berhasil (Lokal)");
                    }

                } catch (err) {
                    console.error(err);
                    window.showToast("Gagal Import: " + err.message, true);
                } finally {
                    inputElement.value = '';
                }
            };
            reader.readAsText(file);
        };
    </script>
</body>
</html>
